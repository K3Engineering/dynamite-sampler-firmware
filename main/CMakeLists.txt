idf_component_register(
    SRCS "main.cpp" "ble_ota.cpp" "adc_proc.cpp" "ble_proc.cpp" "ADS131M0x.cpp"
    INCLUDE_DIRS ${CMAKE_CURRENT_BINARY_DIR}  # so that the srcs can include autogenerated files.
)

# A custom target is always out of date. This forces cmake to run the COMMAND on every build.
add_custom_target(
    build_metadata_target
    COMMAND python ${CMAKE_CURRENT_SOURCE_DIR}/generate_build_metadata.py > ${CMAKE_CURRENT_BINARY_DIR}/build_metadata.h
    COMMENT "Generating build metadata header file. NEW APPROACH"
    BYPRODUCTS ${CMAKE_CURRENT_BINARY_DIR}/meta.h
)
add_dependencies(${COMPONENT_TARGET} build_metadata_target)
